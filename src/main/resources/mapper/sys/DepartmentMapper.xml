<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="top.longmarch.sys.dao.DepartmentDao">

    <select id="getDepartmentList" resultType="top.longmarch.sys.entity.vo.DepartmentTree">
        SELECT
            t2.id,
            t2.parent_id AS pid,
            t2.parent_ids AS pids,
            t2.sort,
            t2.dep_name AS depName,
            COUNT(t1.user_id) AS userCount
        FROM sys_department_user_rel t1
        RIGHT JOIN sys_department t2 ON t1.department_id = t2.id
        GROUP BY t2.id ORDER BY t2.sort DESC
    </select>

    <select id="handleLoadDepartmentUsers" resultType="top.longmarch.sys.entity.vo.DepartmentUserDTO">
        SELECT
            t1.id AS userId,
            t1.username,
            CASE WHEN t2.user_id IS NULL THEN FALSE ELSE TRUE END AS checked
        FROM sys_user t1 LEFT JOIN sys_department_user_rel t2 ON t1.id = t2.user_id AND t2.department_id = #{depId}
        ORDER BY t1.id DESC
    </select>

</mapper>
